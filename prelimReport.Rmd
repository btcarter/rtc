---
title: "OAT"
author: "Benjamin Carter"
date: "6/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
# paths V:\Depts\CtrTransRsch\Dept Private\CTR Staff\PROJECT - Readiness to change manuscript\DATA
data.dir.path <- file.path(
  "V:",
  "Depts", 
  "CtrTransRsch", 
  "Dept Private", 
  "CTR Staff", 
  "PROJECT - Readiness to change manuscript", 
  "DATA"
  )
```

```{r loadData, include=FALSE}
df <- readxl::read_xlsx(
  file.path(data.dir.path, "Nick_Rural16_OAT 6-11-20.xlsx")
  )

df2 <- readxl::read_xlsx(
  file.path(data.dir.path, "OAT_16S_0820_2018.xlsx")
  )
```


```{r selection}
df.processed <- df %>% 
  mutate(
    Gender = ifelse(
      Gender == 1,
      "Female",
      "Male"
      ),
    rtc_diet = ifelse(
      `1a_pre` == 1,
      "precontemplative",
      ifelse(
        `1a_pre` == 2,
        "contemplative",
        ifelse(
          `1a_pre` == 3,
          "preparation",
          ifelse(
            `1a_pre` == 4,
            "action",
            ifelse(
              `1a_pre` == 5,
              "maintain",
              `1a_pre`
            )
          )
        )
      )
    ),
    rtc_exercise = ifelse(
      `2a_pre` == 1,
      "precontemplative",
      ifelse(
        `2a_pre` == 2,
        "contemplative",
        ifelse(
          `2a_pre` == 3,
          "preparation",
          ifelse(
            `2a_pre` == 4,
            "action",
            ifelse(
              `2a_pre` == 5,
              "maintain",
              `2a_pre`
            )
          )
        )
      )
    ),
    rtc_diet_groups = ifelse(
      `1a_pre` == 1,
      "Pre/Contemplative",
      ifelse(
        `1a_pre` == 2,
        "Pre/Contemplative",
        ifelse(
          `1a_pre` == 3,
          "Preparation",
          ifelse(
            `1a_pre` == 4,
            "Action",
            ifelse(
              `1a_pre` == 5,
              "Maintain",
              `1a_pre`
            )
          )
        )
      )
    ),
    rtc_exercise_groups = ifelse(
    `2a_pre` == 1,
    "Pre/Contemplative",
    ifelse(
      `2a_pre` == 2,
      "Pre/Contemplative",
      ifelse(
        `2a_pre` == 3,
        "Preparation",
        ifelse(
          `2a_pre` == 4,
          "Action",
          ifelse(
            `2a_pre` == 5,
            "Maintain",
            `2a_pre`
          )
        )
      )
    )
  )
) %>% 
  filter(
    !is.na(`1a_pre`),
    !is.na(`2a_pre`)
  ) %>% 
  select(
    rtc_diet,
    rtc_diet_groups,
    rtc_exercise,
    rtc_exercise_groups,
    Gender,
    Age,
    Start_Weight = Todays_Weight,
    BMI,
    MaxWeightLost,
    pWeightLost,
    Met7GoalCore,
    Met7GoalOVL,
    Met5GoalCore,
    Met5GoalOVL,
    Core,
    AfterCore,
    `Number of Sessions`,
    FatGramGoalMet,
    Met_Fat_Gram,
    Exercise_Goal_50_Met,
    Met_Activity_Goal
  )


```


# Descriptives

```{r}
tab1 <- compareGroups::compareGroups(
   ~ . - Site - Time - ID - Group - StudyID,
  data = df.processed
  )

compareGroups::createTable(
  tab1
  )

```

# Regression

```{r}
model <- glm(formula = rtc_diet*rtc_exercise + Age + Gender + BMI, data = df.processed, family = binomial) %>% summary()
```



